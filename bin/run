#!/bin/bash -e

case "$(uname -s)" in
    Darwin)     WORKDIR="${WORKDIR:-/home/core/share/containers/salt-docker}" ;;
    Linux)      WORKDIR="${WORKDIR:-$PWD}" ;;
esac

IMAGE="${IMAGE:-trevorj/ubuntu-salt-minion:local}"

[[ -z "$MINION_ID" ]] \
    || ARGS+=" -e MINION_ID=$MINION_ID"

#[[ -z "$MINION_ROLE" ]] \
#    || ARGS+=" -e MINION_ROLE=$MINION_ROLE"

exec docker run -t -i \
    -v "${STATES:-$WORKDIR/salt}:/srv/salt" \
    -v "${PILLAR:-$WORKDIR/pillar}:/srv/pillar" \
    $ARGS \
    "$IMAGE" \
    "$@"
